<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://kougazhang.github.io/cdn/basic/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

        <title>又拍云文档中心</title>

        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/prettify.css" rel="stylesheet">
        <link href="../../css/main.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="navbar navbar-upyun" role="navigation">
    <div class="container clearfix">
        <div class="navbar-header">
            <a class="navbar-brand" href="https://www.upyun.com/">又拍云文档中心</a>
        </div>

        <div class="navbar-collapse collapse pull-right">
            <ul class="nav navbar-nav">
            
              <li class="pull-left">
                
                <a href="">文档首页</a>
                
              </li>
            
              <li class="pull-left">
                
                <a href="cdn/">CDN</a>
                
              </li>
            
              <li class="pull-left">
                
                <a href="live/Introduction/">直播</a>
                
              </li>
            
              <li class="pull-left">
                
                <a href="video/">点播&短视频</a>
                
              </li>
            
              <li class="pull-left">
                
                <a href="api/">云存储</a>
                
              </li>
            
              <li class="pull-left">
                
                <a href="cloud/">云处理</a>
                
              </li>
            
              <li class="pull-left">
                
                <a href="ai/audit/">人工智能</a>
                
              </li>
            
              <li class="pull-left">
                
                <a href="download/">SDK&工具</a>
                
              </li>
            
              <li class="pull-left">
                
                <a href="faq/">常见问题</a>
                
              </li>
            
                <li>
                    <a href="https://segmentfault.com/upyun" target="_blank">技术问答</a>
                </li>
            </ul>

            <ul class="list-unstyled navbar-right clearfix">
                <li class="login"><a href="https://console.upyun.com/#/login/">登录</a></li>
                <li class="reg"><a href="https://console.upyun.com/#/register/">注册</a></li>
            </ul>
        </div>
    </div>
</div>


        <div class="container" id="main-wrapper">
            <div class="toolbar clearfix">
  <ol class="breadcrumb pull-left">
    <li><a href="">文档</a></li>
    <li>Basic</li>
  </ol>

  
    
      <a href="https://github.com/kougazhang/cdn-docs/" class="github-edit pull-right"><i class="fa fa-github"></i> Edit on GitHub</a>
    
  

</div>
            <div class="bs-sidebar hidden-print toc"  data-spy="affix" data-offset-top="120" role="complementary">
  <ul class="nav bs-sidenav">
    
      

    
      
        
      

    
      
        
      

    
      
        
      

    
      
        
      

    
      
        
      

    
      
        
      

    
      
        
      

    
      
        
      

    
  </ul>


</div>



            <div class="content-body" role="main">

<h1>Basic</h1>

<h2 id="_1">创建服务<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p><strong>第一步：选择服务类型</strong></p>
<p>登录 <a href="https://console.upyun.com/login/">又拍云管理控制台</a>，在控制台页面，分别点击右上角的 <code>服务</code> 、<code>创建服务</code> 等按钮，选择服务类型。根据业务情况，可选择 <code>全网加速服务</code> 或 <code>直播加速服务</code> 。具体操作如下图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-choose-server.png" height="490" width="800" /></p>
<p><strong>第二步：填写配置信息</strong></p>
<p>选择服务类型之后，则进入服务创建阶段，需要进行源站类型、回源配置、操作员设置等步骤。具体配置界面可参见如下图所示：</p>
<p>创建服务：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-create-server.png" height="490" width="800" /></p>
<p>创建操作员：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-create-operation.png" height="490" width="800" /></p>
<p><strong>源站类型</strong></p>
<p>目前源站类型包括 <code>又拍云</code> 和 <code>自主源</code>。其中 <code>又拍云</code> 表示资源都存放在又拍云分布式对象存储服务上，同时附加了 CDN 服务的支持，因此也拥有绝大多数又拍云 CDN 的功能；而 <code>自主源</code> 则表示资源都存放在客户自己的源站或第三方云存储服务上，仅使用又拍云 CDN 服务。</p>
<p>配置引导</p>
<p>系统默认会选择 <code>自主源</code>，请根据具体业务需求进行选择。配置界面如下图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-choose-orion.png" height="490" width="800" /></p>
<blockquote>
<p>如果您的资源都托管在第三方云存储平台或者自有源上，请选择 <code>自主源</code></p>
<p>如果您准备把静态资源都托管在又拍云对象存储平台上，请选择 <code>又拍云</code></p>
</blockquote>
<p><strong>回源配置</strong></p>
<p>回源配置是 CDN 服务创建最重要的环节，请谨慎配置。也可去功能配置界面进行设置，依次进入：服务 &gt; 功能配置 &gt; 基础配置 &gt; 回源配置，点击管理按钮即可配置。如下截图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-orion-management.png" height="490" width="800" /></p>
<p><strong>回源 Host</strong></p>
<p>该配置是指 CDN 节点回源过程中所需访问的源站服务器上的域名。CDN 节点回源时会在 HTTP 请求头中 Host 字段里填写该域名，以支持源服务器可通过此 Host 做的特殊处理逻辑，一般是域名形式的字符串，当然也支持任意字符串形式。</p>
<p>配置引导</p>
<p>1.回源 Host 为可选配置项，特别地，如果该自定义值为空，则该服务下的加速域名就会作为回源HOST</p>
<p>2.自定义：可以根据需要修改回源 Host，请保证该域名可以正确访问，否则会出现回源失败的情况</p>
<p><strong>回源协议</strong></p>
<p>默认情况下，我们都会以 HTTP 协议回源，您也可以采用 HTTPS 协议回源。另外一个特别的选项是协议跟随，当启用该特性时，回源协议始终会和客户端访问 CDN 的协议保持一致，即客户端用 HTTP 协议访问我们 CDN，那么回源时我们也会用 HTTP 协议进行回源，同样，若采用 HTTPS 访问，那么回源也是 HTTPS。</p>
<p>配置引导</p>
<p>当我们选择 HTTP 协议回源时，回源地址的端口号默认为 80，而选择 HTTPS 协议回源时，端口号默认为 443。当然，你也可以手动指定特殊的端口号，例如 8080 或 8443。</p>
<p>注意事项</p>
<p>选择 <code>协议跟随</code> 后，回源地址的端口号配置将仅作用于回源协议为 HTTP 的情况，默认 80，当然你也可以自定义为其他值，而回源协议为 HTTPS 时端口号则始终固定为 443，且目前暂时不支持修改此固定值。因此，若之前选择 HTTPS 协议回源 且自定义设置过端口号的用户需要注意，切换到 <code>协议跟随</code> 模式下时，自定义的端口号将仅作用于回源协议为 HTTP 的情况。</p>
<p><strong>线路配置</strong></p>
<p>线路配置包括回源地址、端口号、主备线路、轮询权重、最大失败次数、静默时间等高级设置。其中回源地址则表示源站实际可访问的网络地址，可填 IP 地址或域名地址，如果是域名地址，那么 CDN 在回源时会对该域名地址进行 DNS 解析，然后针对解析出来的 IP 地址进行访问，因此若解析失败将会导致回源异常。</p>
<p>配置引导</p>
<p>配置界面如下截图所示，以下将重点介绍主备线路、轮询权重、最大失败次数和静默时间。</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-line-config.png" height="490" width="800" /></p>
<ul>
<li>主、备线路</li>
</ul>
<p>回源地址配置中除了默认的 <code>主线路</code> 外，我们还支持 <code>备份线路</code>  的配置。默认情况下， <code>主线路</code> 多个回源地址会以 RR 轮询方式进行调度，当且仅当所有 <code>主线路</code> 回源地址均不可达时，此时我们将使用 <code>备份线路</code> 进行转发，若 <code>备份线路</code> 有多个回源地址，那么负载均衡方式也和 <code>主线路</code> 一样，以 Round-Robin 轮询（详情请点击<a href="https://en.wikipedia.org/wiki/Round-robin_scheduling">链接</a>）方式进行调度。</p>
<ul>
<li>轮询权重</li>
</ul>
<p>默认情况下，轮询权重都为 1，表示所有回源地址轮询到的概率均等。当然也可以如上图那样自定义轮询权重，我们看到主线路两个回源地址权重分别是 1 和 2，此时主线路集群在轮询调度中会有 1/3 的概率回 <code>192.168.11.1:80</code> 这个地址，而回 <code>192.168.11.2:80</code> 这个地址的概率则为 2/3。即当前回源地址轮询到的概率可按（当前节点权重/集群所有节点权重之和）这个公式计算。</p>
<ul>
<li>最大失败次数和静默时间</li>
</ul>
<p>表示在一个 <code>静默时间 (fail_timeout)</code> 内如果对应源站的异常次数累计达到当前设置的 <code>最大失败次数 (max_fails)</code> ，那么在下一个  <code>静默时间 (fail_timeout)</code> 内，CDN 就会认为这个源站宕机了，即在这段时间内不会再将请求转发给它。特别地，当 <code>最大失败次数 (max_fails)</code> 其值为 0 时，表示不会进行失败累计，<code>静默时间 (fails_timeout)</code> 也同时失效。</p>
<p>合理设置最大失败次数和静默时间，有助于在源站异常的情况下最大程度减少对线上请求的影响。这里实际上跟 Nginx 核心的 upstream 模块实现机制类似，进一步了解可参考 <a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html#server">链接</a> 。</p>
<p><strong>创建操作员</strong></p>
<p>当您在创建服务的过程中，源站类型选择为 <code>又拍云</code> 时 ，则创建和授权操作员是一个必须的步骤。您可以创建一到多个操作员，满足不同的管理需求，可用于对存储在又拍云的资源进行 API 上传、删除时的认证授权和 FTP 登录等。</p>
<p>配置引导</p>
<p>您可以选择新创建一个操作员，也可以授权已有操作员，并且可以针对权限进行设置，包括可读取、可写入、可删除。配置界面如下图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-create-operation.png" height="490" width="800" /></p>
<p>你也可以在管理后台右上角的帐号下拉菜单中选择 <code>账户管理－&gt; 操作员管理 -&gt; 编辑</code> 进行设置。</p>
<p><strong>域名绑定</strong></p>
<p>针对一个 CDN 服务，假如回源地址相同，可以绑定多个自定义域名( 目前最多可绑定 10 个域名 )。特别地，需要确保该域名已经备案成功，否则无法通过域名绑定审核。另外，审核成功后会以邮件形式进行通知。</p>
<p>配置引导</p>
<p>1.进入功能配置界面，选择 <code>加速域名</code> 模块，点击 <code>域名绑定</code> 按钮，添加域名绑定。</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-domain-binding.png" height="490" width="800" /></p>
<p>2.除常规形式的域名外（包括顶级域名），我们还支持泛域名绑定，比如 <code>*.yourdomain.com</code>；特别地，其中 <code>*</code> 最多支持匹配
    4 层：</p>
<pre><code>[v] *.yourdomain.com =&gt; foo.yourdomain.com
[v] *.yourdomain.com =&gt; bar.yourdomain.com
[v] *.yourdomain.com =&gt; foo.bar.yourdomain.com
[v] *.yourdomain.com =&gt; foo.bar.baz.yourdomain.com
[v] *.yourdomain.com =&gt; foo.bar.baz.qux.yourdomain.com
[x] *.yourdomain.com =&gt; foo.bar.baz.qux.quxx.yourdomain.com

[v] *.bar.yourdomain.com =&gt; foo.bar.yourdomain.com
[v] *.bar.yourdomain.com =&gt; baz.foo.bar.yourdomain.com
[x] *.bar.yourdomain.com =&gt; foo.bar.baz.yourdomain.com
</code></pre>
<p>3.添加域名绑定后，需要到域名服务商的 DNS 解析管理中，将域名的 CNAME 解析到 <code>&lt;bucket&gt;.b0.aicdn.com</code>。</p>
<p><strong>第三步：查看服务状态</strong></p>
<p>以上步骤都配置完成之后，需要查看所创建的服务以及绑定的域名是否处于正常状态，否则无法正常提供服务。</p>
<p>配置引导</p>
<p>1.首先进入服务管理列表，确保所选服务处于 <code>服务中</code> 状态，如下图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-server-status.png" height="490" width="800" /></p>
<p>2.选择相应服务，在管理界面，点击 <code>配置</code> 按钮进入 <code>加速域名</code> 选项，查看绑定的域名是否是 <code>正常</code> 状态。如下图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-domain-status.png" height="490" width="800" /></p>
<hr />
<h2 id="_2">缓存配置<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>缓存配置是指又拍云 CDN 加速节点（包括边缘节点和中心节点）在缓存您的资源文件时遵循的一套过期规则。当资源文件处于过期状态时，此时用户请求会由节点发送至源站，重新获取资源内容并缓存至节点，同时返回给最终用户；当资源内容处于未过期状态时，您的用户请求到达节点后，会由节点直接响应最终用户的请求。合理的配置资源文件缓存时间，能够有效的提升缓存命中率，降低回源率，节省您的源站带宽。</p>
<p>配置引导</p>
<p>登录 <a href="https://console.upyun.com/login/">又拍云管理控制台</a>，选择需要配置的服务，依次进入：服务 &gt; 功能配置 &gt; 基础配置 &gt; 缓存配置，点击管理即可开始配置。如下图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-cache-management.png" height="490" width="800" /></p>
<p><strong>自定义配置</strong></p>
<p>您可以根据自身业务需求，在配置界面的右上角，点击右上角的 <code>添加</code> 按钮进行资源文件缓存时间的配置，CDN 支持三种维度的缓存时间配置规则：</p>
<p><em>根据文件类型设置缓存策略</em></p>
<p>您可以根据模板填充文件类型后缀，根据文件类型来设置缓存时间，如下示例所示：</p>
<blockquote>
<p>/*.(txt,doc,wri,docs)   缓存时间 1 天；</p>
</blockquote>
<p>设置完成后，域名下所有匹配 <code>.txt .doc .wri .docs</code> 的文本资源，在节点的缓存有效时间均为 1 天。</p>
<p><em>根据文件目录设置缓存策略</em></p>
<p>您可以自定义配置文件路径，根据文件路径来设置缓存时间，如下示例所示：</p>
<blockquote>
<p>/dir/*   缓存时间 12 小时</p>
</blockquote>
<p><em>全局配置</em></p>
<p>全局缓存策略适合源站全是静态资源的客户，可以针对该服务一键开启配置缓存时间，开启请谨慎。详细配置可参照如下图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-cache-global.png" height="490" width="800" /></p>
<p>设置完成后，该服务下所有域名匹配的资源，在节点的缓存有效时间均为 7 天。</p>
<p>注意事项：</p>
<p>1.全局缓存在自定义缓存配置里面的优先级是最低的，且优先级不可调节，如下图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-cache-priority.png" height="490" width="800" /></p>
<p>2.全局缓存设置有一个单独的开关，需要开启之后，才可以进行配置</p>
<p><em>默认模板</em></p>
<p>特别地，我们针对自定义缓存配置，默认规划了模板，并且预设了缓存时间，您可以根据具体情况进行修改。具体模板如下：</p>
<pre><code>首页：/  缓存 12 小时；
目录页：/*/    缓存 12 小时；
图片文件：/*.(jpg,jpeg,png,bmp,gif,psd,ico,tga,imb,tiff)      缓存 7 天；
文本文件：/*.(txt,doc,wri,docs,css,js,dot,xml,log,bat,csv)    缓存 1 天；
音视频文件：/*.(wav,mp3,wmv,rmi,aac,mp4,rmvb,mkv,avi,flv,swf,rm,mov,movie,qt)  缓存  7 天；
下载类文件：/*.(exe,ios,apk,ipa,pxl,sis,cab,deb,rar,zip,gzip,tar,7z,bzip2,dmg,gz,wim,tbz,tpz,z,jar)      缓存 7 天；
</code></pre>
<p><strong>不缓存配置</strong></p>
<p>根据业务情况，可以针对一些动态资源文件（ 例如：php、jsp、asp、do、cgi、action、json等）强制配置不缓存， 详细配置可参照如下所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-no-cache.png" height="490" width="800" /></p>
<blockquote>
<p>/*.(asp,php,jsp,do,json)     配置不缓存</p>
</blockquote>
<p><strong>默认缓存策略</strong></p>
<p>在没有匹配到自定义缓存规则且源站也没有返回任何有效缓存头的情况下，我们的默认配置策略如下：</p>
<blockquote>
<p>针对静态资源，所有正常状态码（大于等于 200 小于 400）均缓存 8  天。特别地，301 响应缓存 2 小时，302 响应缓存 20 分钟</p>
<p>针对动态资源，程序会自动识别，则不进行缓存</p>
<p>对于其他大于等于 400 的不正常响应，则不进行缓存</p>
</blockquote>
<p><strong>缓存优先级</strong></p>
<p>请根据具体缓存优先级情况合理配置缓存策略，又拍云 CDN 加速平台目前的缓存优先级如下：</p>
<blockquote>
<p>不缓存配置（后台设置） &gt; 自定义缓存配置（后台配置） &gt; 源站缓存配置 &gt; 默认缓存策略。</p>
</blockquote>
<p>注意事项：</p>
<p>1.源站缓存配置，指 Cache-Control 和 Expires 请求头的设置</p>
<p>2.以上缓存配置优先级目前不支持顺序调节，后续我们会考虑支持</p>
<p><strong>特别声明</strong></p>
<p>针对使用又拍云存储服务的客户，我们暂时不支持缓存配置的自定义设置，我们默认给出了一个默认的缓存配置规则，具体如下：</p>
<blockquote>
<p>对于正常的状态码（大于等于 200 小于 400）：8 天</p>
<p>对于其他大于等于 400 的不正常响应缓存 5 分钟</p>
</blockquote>
<p><strong>动静自动分离</strong></p>
<p>针对 <code>自主源</code> 的 CDN 服务而言，当没有匹配到自定义缓存规则且源站也没有返回任何有效的缓存头时，我们就会对回源内容进行动静识别。特别地，我们会根据响应头中的 <code>Content-Type</code> 字段和 URL 中的文件后缀名来判断是否是静态内容，其中 <code>Content-Type</code> 匹配优先级高于文件后缀名。</p>
<p>参考列表</p>
<p>以下是我们维护的一份 <code>Content-Type</code> 和文件后缀名列表，若满足匹配我们就认为是静态内容：</p>
<blockquote>
<p>Content-Type 列表</p>
</blockquote>
<pre><code>text/css
text/javascript
application/javascript
application/x-javascript

image/gif
image/png
image/jpeg
image/webp
image/tiff
image/x-icon
image/x-ms-bmp
image/svg+xml

application/font-woff
application/java-archive
application/msword
application/pdf
application/postscript
application/zip
application/octet-stream

application/vnd.openxmlformats-officedocument.wordprocessingml.document
application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
application/vnd.openxmlformats-officedocument.presentationml.presentation

audio/mpeg
audio/ogg
audio/x-m4a

video/mp4
video/x-flv
video/x-m4v
</code></pre>
<blockquote>
<p>文件后缀名列表</p>
</blockquote>
<table>
<thead>
<tr>
<th>css</th>
<th>js</th>
<th>jpg</th>
<th>jpeg</th>
<th>gif</th>
<th>ico</th>
<th>png</th>
<th>bmp</th>
<th>pict</th>
<th>csv</th>
</tr>
</thead>
<tbody>
<tr>
<td>doc</td>
<td>pdf</td>
<td>pls</td>
<td>ppt</td>
<td>tif</td>
<td>tiff</td>
<td>eps</td>
<td>ejs</td>
<td>swf</td>
<td>midi</td>
</tr>
<tr>
<td>mida</td>
<td>ttf</td>
<td>eot</td>
<td>woff</td>
<td>otf</td>
<td>svg</td>
<td>svgz</td>
<td>webp</td>
<td>docx</td>
<td>xlsx</td>
</tr>
<tr>
<td>xls</td>
<td>pptx</td>
<td>ps</td>
<td>class</td>
<td>jar</td>
<td>bz2</td>
<td>bzip</td>
<td>exe</td>
<td>flv</td>
<td>gzip</td>
</tr>
<tr>
<td>rar</td>
<td>rtf</td>
<td>tgz</td>
<td>gz</td>
<td>txt</td>
<td>zip</td>
<td>mp3</td>
<td>mp4</td>
<td>ogg</td>
<td>m4a</td>
</tr>
<tr>
<td>m4v</td>
<td>apk</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="_3">缓存刷新<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>上一个章节我们介绍了缓存配置，当 CDN 的资源文件缓存过期之后会回源获取文件并缓存，但是这是一个被动更新的过程，资源更新受限于缓存过期时间。当源站资源更新之后需要快速回源下发到 CDN 节点时，可以使用缓存刷新功能来实现，这是一种主动更新的方式。</p>
<p>配置引导</p>
<p>登录 <a href="https://console.upyun.com/login/">又拍云管理控制台</a>，进入 <code>刷新</code> 栏目，您可以选择 <code>URL 刷新</code>、<code>规则刷新</code>来强制回源更新文件及目录。您也可以在 <code>操作记录</code> 选项查询刷新进度及相关状态。</p>
<p><strong>URL 刷新</strong></p>
<p>当源站有少量文件更新时，可以使用 <code>URL 刷新</code> 来主动删除 CDN 节点上的资源文件。新的请求进来时，CDN 节点会回源获取文件并将新的资源文件缓存至 CDN 节点，所以这是一个主动更新的过程。操作界面如下图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-url-refresh.png" height="490" width="800" /></p>
<p>注意事项：</p>
<p>1.每行一个URL地址，每个 URL 地址以 http://或https://开头，例如：<code>http://example.com/image/test.jpg</code></p>
<p>2.每次输入不超过 50 个，刷新任务全网生效时间大约 5 到 10 分钟</p>
<p><strong>规则刷新</strong></p>
<p>当源站有针对资源进行批量更新时，可以通过 <code>规则刷新</code> 来刷新节点缓存文件。实际上，规则刷新并没有删除节点资源文件，规则一旦生效之后，缓存在 CDN 节点的文件会被致过期，新的请求会回源校验一次，如果源站文件有更新，则将新的文件响应给最终用户并替换节点上的旧文件。操作界面如下图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-rule-refresh.png" height="490" width="800" /></p>
<p>规则示例：</p>
<pre><code>http://example.com/image/＊
http://example.com/image/＊.jpg
http://example.com/image/＊!upyun（ 适用于自定义缩略图版本 ）
</code></pre>
<p>注意事项：</p>
<p>1.每行一个路径规则，每个路径规则以 http:// 或 https:// 开头，每次输入不超过 10
   个，例如：<code>http://example.com/image/＊</code></p>
<p>2.规则刷新主要用于对使用客户自主源站的 CDN 服务，执行后会在 10 分钟内生效</p>
<p>特别声明：</p>
<p>1.如您使用了又拍云对象存储服务时，如果您通过 <code>规则刷新</code> 来刷新缓存的话，基于平台保护，<code>规则刷新</code> 生效时间是 1 个小时，请谨慎操作</p>
<p>2.特别地，使用了又拍云对象存储服务时，存储中资源更新（替换或删除）时会自动触发 CDN 节点刷新缓存，会在 5 分钟内生效，所以您无需进行手动刷新操作</p>
<p><strong>URL 预热</strong></p>
<p>当源站有新增新的资源文件时，可将这些新文件提前缓存至 CDN 节点，最终用户第一次访问这些资源文件时， CDN 节点不需要回源站请求文件资源了。一方面可减少用户突发访问时的回源量，另一方面可以加快资源文件的首次访问速度。操作界面如下图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-url-preheat.png" height="490" width="800" /></p>
<p>注意事项：建议不要同时预热太多资源文件，否则会对源站造成回源压力</p>
<p><strong>操作记录</strong></p>
<p>进行 <code>URL 刷新</code> 、 <code>规则刷新</code> 、<code>URL 预热</code> 操作之后，界面窗口会立马跳至操作记录界面，您可以实时查看当前操作的进度反馈及相关状态。您也可以查看历史操作记录，我们默认保留了 3 天的数据。</p>
<hr />
<h2 id="_4">统计分析<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>为了更加透明的展示终端用户访问 CDN 以及 CDN 回源的访问情况，又拍云 CDN 服务从带宽、流量、请求数等维度进行了数据统计和分析，方便用户查看和分析，具体功能项参见如下描述：</p>
<ul>
<li>
<p>带宽及流量查询：您可以查询指定时间区间、域名、服务名、地区、运营商等条件下，带宽及流量的曲线图，以及运营商、地区分布及排名情况；</p>
</li>
<li>
<p>请求数查询：您可以查询指定时间区间、域名、服务名、地区、运营商等条件下，用户请求数的曲线图；</p>
</li>
<li>
<p>回源统计：您可以查看指定时间区间、域名、服务名等条件下，带宽及流量曲线以及源站流量分布；</p>
</li>
<li>
<p>查询明细数据：您可以查询指定时间区间、域名、服务名、地区、运营商等条件下，查询每日的流量、请求量、静态请求、动态请求、HTTPS 请求、峰值带宽、峰值带宽时间等明细数据。</p>
</li>
<li>
<p>导出 Excel 报表：您可以查询指定时间区间、域名、服务名、地区、运营商等条件下，可以导出 5 分钟粒度详细的请求数、流量、带宽、峰值带宽时间等详细数据。</p>
</li>
</ul>
<p>配置引导</p>
<p>登陆 <a href="https://console.upyun.com/login/">又拍云管理控制台</a>，在置顶菜单进入 <code>统计</code> 栏目，可查询如上统计分析数据：</p>
<p>查询示例一：查询带宽及请求数曲线图</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-bandwidth-and-request.png" height="490" width="800" /></p>
<p>查询示例二：查询流量地区及运营商分布及排行</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-flow-ranking.png" height="490" width="800" /></p>
<p>查询示例三：查询明细数据</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-flow-details.png" height="490" width="800" /></p>
<p>查询示例四：回源带宽及请求</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-back-to-source-statistics.png" height="490" width="800" /></p>
<p>相关说明：</p>
<p>1.以天为单位查询数据时，您可以查询 5 分钟时间粒度的数据</p>
<p>2.时间区间为大于等于 2 天时，您可以查询 1 小时时间粒度的数据</p>
<hr />
<h2 id="_5">性能监控<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>通过性能监控，可以简单、直观地了解到 CDN 服务质量情况，及时发现和定位问题，并协助解决问题。在界面的主窗口中，您可以查询指定时间区间、域名、服务名、地区、运营商等条件下，对应服务的健康度、缓存命中率、平均下载速度等数据。具体功能项描述如下：</p>
<ul>
<li>
<p>健康度：统计所有请求的 HTTP 状态码，计算 2xx 和 3xx 请求次数所占的比例</p>
</li>
<li>
<p>缓存命中率：统计所有请求数中，命中缓存的请求数所占的比例</p>
</li>
<li>
<p>平均下载速度：可以根据地区和运营商来区分资源文件下载速度和请求耗时</p>
</li>
<li>
<p>拦截攻击次数：拦截的跨站攻击、SQL 注入和其他代码执行等多种攻击的数量（仅限开启 WAF 功能）</p>
</li>
</ul>
<p><strong>配置引导</strong></p>
<p>登陆 <a href="https://console.upyun.com/login/">又拍云管理控制台</a>，在置顶菜单进入 <code>监控</code> 栏目，可查询如上性能监测数据，如下图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-monitor.png" height="490" width="800" /></p>
<p>查询示例一：服务状况历史数据（健康度）</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-monitor-health.png" height="490" width="800" /></p>
<p>查询示例二：健康度详情（回源访问）</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-monitor-health-back-to-source.png" height="490" width="800" /></p>
<p>查询示例三：服务状况历史数据（缓存命中率）</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-monitor-hit.png" height="490" width="800" /></p>
<p>查询示例四：地区平均下载速度</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-monitor-speed.png" height="490" width="800" /></p>
<hr />
<h2 id="_6">日志分析<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>可根据时间粒度，查看相应访问域名下热门文件、热门客户端、热门引用文件、资源状态码、文件大小、热门 IP 等维度 top1000 的统计分析数据。日志分析是以天为粒度进行分析的，第二天凌晨会开始进行日志分析工作，正常情况下，第二天早晨 09:00:00 之前会统计计算完毕。</p>
<p>配置引导</p>
<p>登陆 <a href="https://console.upyun.com/login/">又拍云管理控制台</a>，在置顶菜单进入 <code>工具箱</code>，找到 <code>日志管理</code> 栏目，选择 <code>日志分析</code> 选项。如下图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-log-analysis.png" height="490" width="800" /></p>
<hr />
<h2 id="_7">日志下载<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p>支持以小时粒度的日志下载，可收集详细的终端访问日志；日志文件延迟 1 小时，可以在日志管理模块查询到 1 小时之前的日志文件。</p>
<p>日志命名规则：时间段-访问域名-随机数.gz，日志命名示例：</p>
<blockquote>
<p>10_00-impress-demo.b0.upaiyun.com-9571272666104702574.gz</p>
</blockquote>
<p><strong>日志样例</strong></p>
<pre><code>122.96.42.186 - - [13/Dec/2016:00:00:02 +0800] "GET http://impress-demo.b0.upaiyun.com/kphone/icons/weihui_icon3.png?v=1.0 HTTP/1.1" 200 1851 "-" "Mozilla/4.0" "image/png" 0 Hit "C/200" Static "max-age=900" 0.014 153.101.64.13
</code></pre>
<p><strong>字段说明</strong></p>
<table>
<thead>
<tr>
<th>序号</th>
<th>字段</th>
<th>示例值</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>客户端 IP 地址</td>
<td>122.96.42.186</td>
</tr>
<tr>
<td>2</td>
<td>客户端用户名</td>
<td>-</td>
</tr>
<tr>
<td>3</td>
<td>访问时间与时区</td>
<td>[13/Dec/2016:00:00:02 +0800]</td>
</tr>
<tr>
<td>4</td>
<td>客户端请求方法</td>
<td>GET</td>
</tr>
<tr>
<td>5</td>
<td>请求协议</td>
<td>HTTP</td>
</tr>
<tr>
<td>6      </td>
<td>访问域名         </td>
<td>impress-demo.b0.upaiyun.com  </td>
</tr>
<tr>
<td>7</td>
<td>客户端请求 URI</td>
<td>/kphone/icons/weihui_icon3.png</td>
</tr>
<tr>
<td>8     </td>
<td>请求参数         </td>
<td> v=1.0   </td>
</tr>
<tr>
<td>9 </td>
<td>请求协议版本信息          </td>
<td>HTTP/1.1</td>
</tr>
<tr>
<td>10</td>
<td>响应状态码          </td>
<td>200  </td>
</tr>
<tr>
<td>11    </td>
<td>发送给客户端的字节数</td>
<td>1851  </td>
</tr>
<tr>
<td>12  </td>
<td>Referer 请求头    </td>
<td>-</td>
</tr>
<tr>
<td>13  </td>
<td>User-Agent 头</td>
<td>Mozilla/4.0</td>
</tr>
<tr>
<td>14  </td>
<td>内容类型</td>
<td>image/png</td>
</tr>
<tr>
<td>15  </td>
<td>请求内容大小</td>
<td>0</td>
</tr>
<tr>
<td>16  </td>
<td>缓存命中状态            </td>
<td>Hit  </td>
</tr>
<tr>
<td>17  </td>
<td>源站类型 (U: 云存储 C：自主源)/状态码        </td>
<td>C/200</td>
</tr>
<tr>
<td>18  </td>
<td>动态请求标记            </td>
<td>Static  </td>
</tr>
<tr>
<td>19  </td>
<td>缓存时间            </td>
<td>max-age=900 </td>
</tr>
<tr>
<td>20   </td>
<td>请求处理时间（单位s）  </td>
<td>0.014</td>
</tr>
<tr>
<td>21  </td>
<td>CDN 边缘节点 IP          </td>
<td>153.101.64.13</td>
</tr>
</tbody>
</table>
<p>配置引导</p>
<p>登陆 <a href="https://console.upyun.com/login/">又拍云管理控制台</a>，在置顶菜单进入 <code>工具箱</code>，找到 <code>日志管理</code> 栏目，选择 <code>日志下载</code> 选项。如下图所示：</p>
<p><img src="http://upyun-assets.b0.upaiyun.com/docs/cdn/upyun-cdn-log-download.png" height="490" width="800" /></p>
<p>关于日志分析和下载视频教程请点击 <a href="https://techs.b0.upaiyun.com/videos/cdnpage/upyunlog.html">日志管理视频教程</a>。</p>
<hr />
<p>如有疑问请 <a href="https://www.upyun.com/contact">联系我们</a></p></div>
        </div>

        

        <script src="../../js/jquery.min.js"></script>
        <script src="../../js/bootstrap.min.js"></script>
        <script src="../../js/prettify.min.js"></script>
        <script src="../../js/main.js"></script>
        <script src="../../search/main.js"></script>

        <div id="go-top" data-toggle="tooltip" data-placement="bottom" title="回到顶部"><i class="fa fa-arrow-circle-up"></i></div>

        <footer class="footer clearfix">
    <div class="container">
        <ul class="list-unstyled list-inline pull-left">
            <li><a href="/faq/">FAQ</a></li>
            <!-- <li><a href="Blog"></a></li> -->
            <li><a href="https://github.com/upyun">GitHub</a></li>
            <li><a href="https://segmentfault.com/upyun">技术问答</a></li>
            <li><a href="https://www.upyun.com/zh/join_us.html">加入我们</a></li>
        </ul>
        <p class="pull-right">&copy; 2019 又拍云</p>
    </div>
</footer>
        <script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=6062249992052412388' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();
        </script>
    </body>
</html>